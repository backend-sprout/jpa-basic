# 데이터베이스 스키마 자동 생성 
JPA는 DB 스키마를 자동으로 생성하는 기능을 지원한다.     
 
`xml 방식`하고 `properties 방식` 2가지가 있다.      
책과 강의에서는 `xml 방식`을 설명하고 있지만,  
개인적으로 `properties 방식`이 편하고 간단하다고 판단되기에      
필자는 2가지 방법을 토대로 한번 정리해보고자 한다.          

## XML 방식
```xml
<?xml version="1.0" encoding="UTF-8"?>
<persistence version="2.2"
             xmlns="http://xmlns.jcp.org/xml/ns/persistence" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/persistence http://xmlns.jcp.org/xml/ns/persistence/persistence_2_2.xsd">
    <persistence-unit name="hello">
        <properties>
            <!-- 필수 속성 -->
            <property name="javax.persistence.jdbc.driver" value="org.h2.Driver"/>
            <property name="javax.persistence.jdbc.user" value="sa"/>
            <property name="javax.persistence.jdbc.password" value=""/>
            <property name="javax.persistence.jdbc.url" value="jdbc:h2:tcp://localhost/~/test"/>
            <property name="hibernate.dialect" value="org.hibernate.dialect.H2Dialect"/>
            <!-- 옵션 -->
            <property name="hibernate.show_sql" value="true"/>
            <property name="hibernate.format_sql" value="true"/>
            <property name="hibernate.use_sql_comments" value="true"/>
            <property name="hibernate.hbm2ddl.auto" value="create" /> <!-- 여기가 포인트 -->
        </properties>
    </persistence-unit>
</persistence>
```
스키마 자동 생성 전략을 추가하고 싶다면 `persistence.xml`에    
`<property name="hibernate.hbm2ddl.auto" value="create" />`를 입력하면 된다.  
   
하지만, `스키마 자동 생성 기능이 만든 DDL`은     
운영 환경에서 사용할 만큼 완벽하지 않으므로    
개발환경에서 사용하거나 매핑을 어떻게 해야 하는지 참고하는 정도로만 사용하면 좋다.     
   
**hibernate.hbm2ddl.auto 속성**
|옵션|설명|  
|----|----|   
|create|기존 테이블을 삭제하고 새로 생성한다.<br>`DROP` + `CREATE`|     
|create-drop|create 속성에 추가로 애플리케이션을 종료할 때 생성한 DDL을 제거한다.<br>DROP + CREATE + DROP|   
|update|데이터베이스 테이블과 엔티티 매핑정보를 비교해서 변경 사항만 수정한다.|     
|validate|데이트베이스 테이블과 엔티티 매핑정보를 비교해서<br>차이가 있으면 경고를 남기고 애플리케이션을 실행하지 않는다.|       
|none|자동 생성 기능을 사용하지 않으려면 이 값을 사용하던가<br>`hibernate.hbm2ddl.auto`자체를 사용하지 않는다.|       
     
**주의사항**   
운영서버에서 `create`, `createa-drop`, `update`와 같은 옵션은 절대 사용하면 안 된다.  
기존 데이터베이스를 `drop` 하기에, 오직 개발 서버나 개발 단계에서만 사용하자.    

**추천 전략**   
* 개발 초기 단계 : craete 또는 update
* 초기화 상태로 자동화된 테스트를 진행하는 개발자 환경과 CI 서버 : create, create-drop   
* 테스트 서버 : update 또는 validate 
* [스테이징 운영 서버](https://okky.kr/article/733425) : validate 또는 none
  
**이름 매핑 전략**  
단어와 단어를 구분할때,    
`자바는 카멜케이스`를 주로 사용하고     
`DB는 스네이크 케이스`를 주로 사용한다.    
  
그렇기에 속성명을 명시적으로 지정하고자하면   
`(name = "role_type")`과 같이 작성해야한다.   
하지만, 이 방법 외에도 다른 방법이 존재하는데  
`hibernate.ejb.naming_strategy` 속성을 사용하면 이름 매핑 전략을 변경할 수 있다.  
이름 매핑 전략을 직접 구현할 수도 있지만,   
`org.hibernate.cfg.ImprovedNamingStrategy` 클래스를 제공하기에 이를 이용하면 된다.   
이 클래스는 테이블 명이나 컬럼 명이 생략되면 `카멜 표기법`을 `스네이크 표기법`으로 매핑한다.   

```xml
  <property name="hibernate.physical_naming_strategy" value="org.hibernate.cfg.ImprovedNamingStrategy" />
```  
